#!/bin/python3

import json
import requests
import urllib3
from colorama import Fore as color
import argparse

G = color.GREEN
C = color.CYAN
M = color.MAGENTA
W = color.WHITE

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

def main(url):
    headers = {
        "Content-Type": "application/json",
    }

    data = {
        "query": "query { users { pageInfo { hasNextPage, hasPreviousPage, endCursor, startCursor }, nodes { username } } }"
    }

    response = requests.post(url + "/api/graphql", json=data, headers=headers, verify=False)
    if response.status_code == 200:
        result = response.json()
        users = result['data']['users']['nodes']
        for user in users:
            username = user['username']
            print(f"{G}[{M}+{G}] {M}- {W}{url} {G}[{C}username{G}] {W}{username}")
    else:
        print(f"Request failed with status code: {response.status_code}")

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="Query the GraphQL API and display usernames.")
    parser.add_argument("url", type=str, help="The URL of the GraphQL API endpoint.")
    args = parser.parse_args()
    main(args.url)
